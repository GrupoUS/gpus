# src/routes/ - Pages & Routing

## Package Identity

**Purpose:** File-based routing with TanStack Router  
**Tech:** TanStack Router + React 19

---

## Setup & Run

Routes are auto-discovered by TanStack Router plugin.

```bash
# Development (from root)
bun run dev

# Route types are auto-generated in src/routeTree.gen.ts
```

---

## Patterns & Conventions

### File-Based Routing

```
routes/
├── __root.tsx          # Root layout (wraps all pages)
├── index.tsx           # Dashboard (/)
├── sign-in.tsx         # Sign in page (/sign-in)
├── sign-up.tsx         # Sign up page (/sign-up)
└── crm/
    └── index.tsx       # CRM page (/crm)
```

### Route Definition

✅ **DO:** Use `createFileRoute` for pages
```tsx
// src/routes/index.tsx
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/')({
  component: DashboardPage,
})

function DashboardPage() {
  return <div>Dashboard</div>
}
```

✅ **DO:** Use `createRootRoute` for root layout
```tsx
// src/routes/__root.tsx
import { createRootRoute, Outlet } from '@tanstack/react-router'
import { MainLayout } from '@/components/layout/main-layout'

export const Route = createRootRoute({
  component: () => (
    <MainLayout>
      <Outlet />
    </MainLayout>
  ),
})
```

### Dynamic Routes

✅ **DO:** Use `$` prefix for dynamic params
```tsx
// src/routes/crm/$leadId.tsx
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/crm/$leadId')({
  component: LeadDetailPage,
})

function LeadDetailPage() {
  const { leadId } = Route.useParams()
  return <div>Lead: {leadId}</div>
}
```

### Navigation

✅ **DO:** Use `Link` component for navigation
```tsx
import { Link } from '@tanstack/react-router'

<Link to="/crm">Go to CRM</Link>
<Link to="/crm/$leadId" params={{ leadId: '123' }}>View Lead</Link>
```

✅ **DO:** Use `useNavigate` for programmatic navigation
```tsx
import { useNavigate } from '@tanstack/react-router'

const navigate = useNavigate()
navigate({ to: '/crm' })
```

### Protected Routes

✅ **DO:** Use Clerk's `<SignedIn>` and `<SignedOut>` components
```tsx
import { SignedIn, SignedOut, RedirectToSignIn } from '@clerk/clerk-react'

export const Route = createFileRoute('/crm/')({
  component: () => (
    <>
      <SignedIn>
        <CRMPage />
      </SignedIn>
      <SignedOut>
        <RedirectToSignIn />
      </SignedOut>
    </>
  ),
})
```

---

## Touch Points / Key Files

| File | Purpose |
|------|---------|
| `src/routes/__root.tsx` | Root layout with sidebar |
| `src/routes/index.tsx` | Dashboard page |
| `src/routes/sign-in.tsx` | Sign in page (Clerk) |
| `src/routes/crm/index.tsx` | CRM page |
| `src/routeTree.gen.ts` | Auto-generated route types |

---

## JIT Index Hints

```bash
# Find all routes
rg -n "createFileRoute" src/routes

# Find route params usage
rg -n "useParams" src/routes

# Find navigation
rg -n "useNavigate|Link to=" src/routes
```

---

## Common Gotchas

- **Route types:** Auto-generated by TanStack Router plugin (don't edit `routeTree.gen.ts`)
- **File naming:** Use `__root.tsx` for root layout, `index.tsx` for index routes
- **Dynamic params:** Use `$paramName.tsx` for dynamic segments
- **Nested routes:** Create subdirectories for nested routes
- **Clerk:** Wrap protected routes with `<SignedIn>` component

---

## Pre-PR Checks

```bash
# Ensure routes compile
bun run build
```
