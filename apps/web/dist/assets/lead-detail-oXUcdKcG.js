import{b as x,j as e}from"./vendor-C0IzTJ68.js";import{t as p,g as $,h as W,i as H,j as G,k as re,l as J,m as K,n as X,D as te,o as ne,q as ie,r as le,F as ce,s as f,u as b,v as w,w as N,I as D,x as v,y as R,z as U,E as V,G as _,H as A,T as P,f as u,J as ke,K as Ae,L as Ie,M as se,N as Ee,O as Me,p as F,C as Le,c as Fe,P as q,Q as B,R as Q,e as T,B as z,S as O,U as Pe,V as ze,W as Oe,X as Re,Y as Ue,Z as Ve,_ as _e,$ as qe,a0 as Be,a1 as Qe,a2 as $e,a3 as M,a4 as We,a5 as L}from"./index-C8YxpUQT.js";import{ab as I,p as h,cI as He,cg as Ge,c2 as oe,cJ as Je,cK as Ke,an as Y,ac as Z,cL as Xe,r as Ye,cM as Ze,N as es,X as de,bL as ss,b2 as me,co as xe,aa as ue,cN as as,cO as ae,n as rs,aG as he,o as pe,b0 as ts,A as ns,z as is,ah as ls,af as cs,cP as os}from"./ui-eQKuYNMj.js";import{a as je,c as ge,o as fe,s as C,e as ds,b as ms,_ as xs,l as us,d as hs,f as ps}from"./forms-CH1lNzbM.js";import{C as be,a as Ne,b as ve,c as ye,d as we,e as Ce}from"./command-CoeuBcqE.js";import"./auth-CS6YH2iJ.js";import"./animation-oFsG5JPT.js";import"./charts-CKNPyqfB.js";function js({lead:s,open:i,onOpenChange:r,onClose:l}){const[n,t]=x.useState(!1),a=p.leads.delete.useMutation(),m=async()=>{try{t(!0),await a.mutateAsync({leadId:s.id}),h.success(`Lead "${s.name}" excluÃ­do com sucesso`),r(!1),l?.()}catch(c){h.error(`Erro ao excluir lead: ${c instanceof Error?c.message:"Erro desconhecido"}`)}finally{t(!1)}};return e.jsx($,{onOpenChange:r,open:i,children:e.jsxs(W,{children:[e.jsxs(H,{children:[e.jsx(G,{children:"Excluir Lead"}),e.jsxs(re,{children:["Tem certeza que deseja excluir o lead ",e.jsxs("strong",{children:['"',s.name,'"']}),"?",e.jsx("br",{}),e.jsx("br",{}),"Esta aÃ§Ã£o Ã© irreversÃ­vel e tambÃ©m excluirÃ¡ todas as atividades, tarefas e campos personalizados associados a este lead."]})]}),e.jsxs(J,{children:[e.jsx(K,{disabled:n,children:"Cancelar"}),e.jsx(X,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:n,onClick:m,children:n?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Excluindo..."]}):"Excluir"})]})]})})}const gs=fe({name:C().min(2,"Nome deve ter pelo menos 2 caracteres"),phone:C().min(10,"Telefone invÃ¡lido"),email:C().email("Email invÃ¡lido").optional().or(us("")),profession:C().optional(),interestedProduct:C().optional(),temperature:xs(["frio","morno","quente"]).optional(),mainPain:C().optional(),mainDesire:C().optional(),hasClinic:ms().optional(),clinicName:C().optional(),clinicCity:C().optional(),yearsInAesthetics:ds().optional(),currentRevenue:C().optional()});function fs({lead:s,open:i,onOpenChange:r}){const l=p.leads.create.useMutation(),n=je({resolver:ge(gs),defaultValues:{name:s.name||"",phone:s.phone||"",email:s.email||"",profession:s.profession||"",interestedProduct:s.interestedProduct||"",temperature:s.temperature||"frio",mainPain:s.mainPain||"",mainDesire:s.mainDesire||"",hasClinic:s.hasClinic,clinicName:s.clinicName||"",clinicCity:s.clinicCity||"",yearsInAesthetics:s.yearsInAesthetics||void 0,currentRevenue:s.currentRevenue||""}}),t=async a=>{try{await l({leadId:s.id,patch:{name:a.name,phone:a.phone,email:a.email||void 0,profession:a.profession||void 0,interestedProduct:a.interestedProduct||void 0,temperature:a.temperature,mainPain:a.mainPain||void 0,mainDesire:a.mainDesire||void 0,hasClinic:a.hasClinic,clinicName:a.clinicName||void 0,clinicCity:a.clinicCity||void 0,yearsInAesthetics:a.yearsInAesthetics,currentRevenue:a.currentRevenue||void 0}}),h.success("Lead atualizado com sucesso"),r(!1)}catch(m){h.error(`Erro ao atualizar lead: ${m instanceof Error?m.message:"Erro desconhecido"}`)}};return e.jsx(te,{onOpenChange:r,open:i,children:e.jsxs(ne,{className:"max-h-[90vh] overflow-y-auto sm:max-w-lg",children:[e.jsx(ie,{children:e.jsx(le,{children:"Editar Lead"})}),e.jsx(ce,{...n,children:e.jsxs("form",{className:"space-y-4",onSubmit:n.handleSubmit(t),children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(f,{control:n.control,name:"name",render:({field:a})=>e.jsxs(b,{children:[e.jsx(w,{children:"Nome"}),e.jsx(N,{children:e.jsx(D,{placeholder:"Nome completo",...a})}),e.jsx(v,{})]})}),e.jsx(f,{control:n.control,name:"phone",render:({field:a})=>e.jsxs(b,{children:[e.jsx(w,{children:"Telefone"}),e.jsx(N,{children:e.jsx(D,{placeholder:"11999999999",...a})}),e.jsx(v,{})]})})]}),e.jsx(f,{control:n.control,name:"email",render:({field:a})=>e.jsxs(b,{children:[e.jsx(w,{children:"Email"}),e.jsx(N,{children:e.jsx(D,{placeholder:"email@exemplo.com",type:"email",...a})}),e.jsx(v,{})]})}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(f,{control:n.control,name:"interestedProduct",render:({field:a})=>e.jsxs(b,{children:[e.jsx(w,{children:"Produto de Interesse"}),e.jsxs(R,{onValueChange:a.onChange,value:a.value,children:[e.jsx(N,{children:e.jsx(U,{children:e.jsx(V,{placeholder:"Selecione"})})}),e.jsxs(_,{children:[e.jsx(A,{value:"otb",children:"OTB 2025"}),e.jsx(A,{value:"black_neon",children:"NEON"}),e.jsx(A,{value:"trintae3",children:"TRINTAE3"})]})]}),e.jsx(v,{})]})}),e.jsx(f,{control:n.control,name:"temperature",render:({field:a})=>e.jsxs(b,{children:[e.jsx(w,{children:"Temperatura"}),e.jsxs(R,{onValueChange:a.onChange,value:a.value,children:[e.jsx(N,{children:e.jsx(U,{children:e.jsx(V,{placeholder:"Selecione"})})}),e.jsxs(_,{children:[e.jsx(A,{value:"frio",children:"â„ï¸ Frio"}),e.jsx(A,{value:"morno",children:"ðŸŒ¤ï¸ Morno"}),e.jsx(A,{value:"quente",children:"ðŸ”¥ Quente"})]})]}),e.jsx(v,{})]})})]}),e.jsx(f,{control:n.control,name:"mainPain",render:({field:a})=>e.jsxs(b,{children:[e.jsx(w,{children:"Dor Principal"}),e.jsx(N,{children:e.jsx(P,{className:"resize-none",placeholder:"Qual a principal dor do lead?",...a})}),e.jsx(v,{})]})}),e.jsx(f,{control:n.control,name:"mainDesire",render:({field:a})=>e.jsxs(b,{children:[e.jsx(w,{children:"Desejo / Objetivo"}),e.jsx(N,{children:e.jsx(P,{className:"resize-none",placeholder:"Qual o principal objetivo do lead?",...a})}),e.jsx(v,{})]})}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(f,{control:n.control,name:"profession",render:({field:a})=>e.jsxs(b,{children:[e.jsx(w,{children:"ProfissÃ£o"}),e.jsx(N,{children:e.jsx(D,{placeholder:"Ex: Dentista",...a})}),e.jsx(v,{})]})}),e.jsx(f,{control:n.control,name:"yearsInAesthetics",render:({field:a})=>e.jsxs(b,{children:[e.jsx(w,{children:"Anos em EstÃ©tica"}),e.jsx(N,{children:e.jsx(D,{placeholder:"0",type:"number",...a})}),e.jsx(v,{})]})})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(f,{control:n.control,name:"clinicName",render:({field:a})=>e.jsxs(b,{children:[e.jsx(w,{children:"Nome da ClÃ­nica"}),e.jsx(N,{children:e.jsx(D,{placeholder:"Nome da clÃ­nica",...a})}),e.jsx(v,{})]})}),e.jsx(f,{control:n.control,name:"clinicCity",render:({field:a})=>e.jsxs(b,{children:[e.jsx(w,{children:"Cidade da ClÃ­nica"}),e.jsx(N,{children:e.jsx(D,{placeholder:"Cidade",...a})}),e.jsx(v,{})]})})]}),e.jsx(f,{control:n.control,name:"currentRevenue",render:({field:a})=>e.jsxs(b,{children:[e.jsx(w,{children:"Faturamento Atual"}),e.jsx(N,{children:e.jsx(D,{placeholder:"Ex: R$ 10.000 - R$ 20.000",...a})}),e.jsx(v,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(u,{onClick:()=>r(!1),type:"button",variant:"outline",children:"Cancelar"}),e.jsx(u,{disabled:n.formState.isSubmitting,type:"submit",children:n.formState.isSubmitting?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Salvando..."]}):"Salvar"})]})]})})]})})}function bs({lead:s,onClose:i}){const[r,l]=x.useState(!1),[n,t]=x.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(ke,{children:[e.jsx(Ae,{asChild:!0,children:e.jsxs(u,{className:"h-8 w-8 p-0",variant:"ghost",children:[e.jsx("span",{className:"sr-only",children:"Abrir menu"}),e.jsx(He,{className:"h-4 w-4"})]})}),e.jsxs(Ie,{align:"end",children:[e.jsxs(se,{onClick:()=>l(!0),children:[e.jsx(Ge,{className:"mr-2 h-4 w-4"}),"Editar"]}),e.jsx(Ee,{}),e.jsxs(se,{className:"text-destructive focus:text-destructive",onClick:()=>t(!0),children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),"Excluir"]})]})]}),e.jsx(fs,{lead:s,onOpenChange:l,open:r}),e.jsx(js,{lead:s,onClose:i,onOpenChange:t,open:n})]})}function Ns(s){return s==="sdr"?"SDR":s==="admin"?"Vendas":""}function vs({leadId:s,currentOwnerId:i}){const r=x.useId(),{data:l}=p.users.listSystemUsers.useQuery(),n=p.leads.update.useMutation(),t=async a=>{await n.mutateAsync({leadId:s,patch:{assignedTo:a==="none"?void 0:Number(a)}})};return l?e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(Me,{htmlFor:r,children:"ResponsÃ¡vel"}),e.jsxs(R,{onValueChange:t,value:i!=null?String(i):"none",children:[e.jsx(U,{className:"w-full",id:r,children:e.jsx(V,{placeholder:"Selecione o responsÃ¡vel"})}),e.jsxs(_,{children:[e.jsx(A,{value:"none",children:e.jsx("span",{className:"text-muted-foreground",children:"Sem responsÃ¡vel"})}),l.map(a=>e.jsx(A,{value:a.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:a.name}),e.jsx("span",{className:"text-muted-foreground text-xs uppercase",children:Ns(a.role)})]})},a.id))]})]})]}):e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:[e.jsx(Je,{className:"h-4 w-4"}),e.jsx("span",{children:"Carregando..."})]})}function Se({leadId:s,objection:i,onSuccess:r,onCancel:l}){const[n,t]=x.useState(i?.objectionText||""),[a,m]=x.useState(!1),c=async()=>{if(n.trim()){m(!0);try{h.info("ObjeÃ§Ãµes ainda nÃ£o foram implementadas no novo backend"),t(""),r?.()}catch{h.error("Erro ao salvar objeÃ§Ã£o")}finally{m(!1)}}};return e.jsxs("div",{className:"space-y-4 rounded-lg border border-border/50 bg-card p-4",children:[e.jsx(P,{className:"min-h-[100px]",onChange:d=>t(d.target.value),placeholder:"Descreva a objeÃ§Ã£o...",value:n}),e.jsxs("div",{className:"flex justify-end gap-2",children:[l&&e.jsx(u,{disabled:a,onClick:l,variant:"ghost",children:"Cancelar"}),e.jsxs(u,{disabled:a||!n.trim(),onClick:c,children:[a&&e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),i?"Atualizar":"Salvar"]})]})]})}function ys({leadId:s}){const i=[],[r,l]=x.useState(null),[n,t]=x.useState(null),a=async()=>{if(n)try{h.info("ObjeÃ§Ãµes ainda nÃ£o foram implementadas no novo backend")}catch{h.error("Erro ao remover objeÃ§Ã£o")}finally{t(null)}},m=c=>!1;return i.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-muted-foreground",children:[e.jsx(Ke,{className:"mb-2 h-10 w-10 opacity-20"}),e.jsx("p",{children:"Nenhuma objeÃ§Ã£o registrada"})]}):e.jsxs("div",{className:"space-y-4",children:[i.map(c=>r===c.id?e.jsx(Se,{leadId:s,objection:c,onCancel:()=>l(null),onSuccess:()=>l(null)},c.id):e.jsxs("div",{className:"group relative rounded-lg border border-border/50 bg-card p-4 transition-colors hover:bg-muted/5",children:[e.jsxs("div",{className:"mb-2 flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-xs",children:[e.jsx("span",{className:"font-medium text-foreground",children:c.recordedByDetails?.name||"UsuÃ¡rio"}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:Y(c.recordedAt,{addSuffix:!0,locale:F})})]}),m()]}),e.jsx("p",{className:"whitespace-pre-wrap text-sm leading-relaxed",children:c.objectionText})]},c.id)),e.jsx($,{onOpenChange:c=>!c&&t(null),open:!!n,children:e.jsxs(W,{children:[e.jsxs(H,{children:[e.jsx(G,{children:"Excluir objeÃ§Ã£o?"}),e.jsx(re,{children:"Tem certeza que deseja excluir esta objeÃ§Ã£o? Esta aÃ§Ã£o nÃ£o pode ser desfeita."})]}),e.jsxs(J,{children:[e.jsx(K,{children:"Cancelar"}),e.jsx(X,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:a,children:"Excluir"})]})]})})]})}function ws({leadId:s}){const[i,r]=x.useState(!1);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg tracking-tight",children:"ObjeÃ§Ãµes"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Registre e acompanhe as objeÃ§Ãµes deste lead."})]}),!i&&e.jsxs(u,{className:"gap-2",onClick:()=>r(!0),size:"sm",children:[e.jsx(Z,{className:"h-4 w-4"}),"Adicionar ObjeÃ§Ã£o"]})]}),i&&e.jsx("div",{className:"slide-in-from-top-2 animate-in duration-200",children:e.jsx(Se,{leadId:s,onCancel:()=>r(!1),onSuccess:()=>r(!1)})}),e.jsx(ys,{leadId:s})]})}function Cs({leadId:s}){const{data:i}=p.leads.get.useQuery({id:s}),{data:r}=p.leads.get.useQuery({id:i?.referredById??0},{enabled:!!i?.referredById}),l=void 0;return!i||!i.referredById&&l?.totalReferrals===0?null:e.jsxs("section",{className:"space-y-3",children:[e.jsxs("h3",{className:"flex items-center gap-2 font-medium text-muted-foreground text-sm uppercase tracking-wider",children:[e.jsx(Xe,{className:"h-4 w-4"})," IndicaÃ§Ãµes & Cashback"]}),e.jsxs("div",{className:"grid gap-4",children:[i.referredById&&r&&e.jsx(Le,{className:"border-l-4 border-l-blue-500 bg-blue-50/20",children:e.jsxs(Fe,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"rounded-full bg-blue-100 p-2 text-blue-600",children:e.jsx(Ye,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Indicado por"}),e.jsx("p",{className:"font-medium",children:r.name})]})]})}),l]})]})}function Ss({leadId:s,onTagAdded:i}){const[r,l]=x.useState(!1),[n]=x.useState(""),[t,a]=x.useState(""),[m,c]=x.useState(""),[d,g]=x.useState("#2563eb");x.useEffect(()=>{const j=setTimeout(()=>{c(t)},300);return()=>clearTimeout(j)},[t]);const{data:k}=p.tags.searchTags.useQuery({query:m},{enabled:r}),S=p.useUtils(),o=p.tags.create.useMutation({onSuccess:()=>S.tags.searchTags.invalidate()}),y=p.tags.addTagToLead.useMutation({onSuccess:()=>S.tags.getLeadTags.invalidate({leadId:s})}),[E,ee]=x.useState(!1),De=async()=>{if(t){ee(!0);try{const j=await o.mutateAsync({name:t,color:d});await y.mutateAsync({leadId:s,tagId:j.id}),h.success("Tag criada e adicionada com sucesso"),l(!1),a(""),i?.()}catch{h.error("Erro ao criar tag")}finally{ee(!1)}}},Te=async j=>{try{await y.mutateAsync({leadId:s,tagId:j}),h.success("Tag adicionada com sucesso"),l(!1),i?.()}catch{h.error("Erro ao adicionar tag")}};return e.jsxs(q,{onOpenChange:l,open:r,children:[e.jsx(B,{asChild:!0,children:e.jsxs(u,{"aria-expanded":r,className:"w-[200px] justify-between",role:"combobox",variant:"outline",children:[n?k?.find(j=>j.name===n)?.name:"Adicionar tag...",e.jsx(Ze,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(Q,{className:"w-[300px] p-0",children:e.jsxs(be,{children:[e.jsx(Ne,{onValueChange:a,placeholder:"Buscar tag...",value:t}),e.jsxs(ve,{children:[e.jsx(ye,{children:t&&e.jsxs("div",{className:"flex flex-col gap-2 p-2",children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:"Tag nÃ£o encontrada."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-8 w-8 border-none p-0",onChange:j=>g(j.target.value),type:"color",value:d}),e.jsxs(u,{className:"w-full justify-start",disabled:E,onClick:De,size:"sm",variant:"secondary",children:[E?e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Z,{className:"mr-2 h-4 w-4"}),'Criar "',t,'"']})]})]})}),e.jsx(we,{children:k?.map(j=>e.jsxs(Ce,{onSelect:()=>Te(j.id),value:j.name,children:[e.jsx("div",{className:"mr-2 h-2 w-2 rounded-full",style:{backgroundColor:j.color||"#ccc"}}),j.name,e.jsx(es,{className:T("ml-auto h-4 w-4",n===j.name?"opacity-100":"opacity-0")})]},j.id))})]})]})})]})}function Ds({tag:s,leadId:i,onRemove:r}){const l=p.tags.removeTagFromLead.useMutation(),[n,t]=x.useState(!1),a=async()=>{t(!0);try{await l.mutateAsync({leadId:i,tagId:s.id}),h.success("Tag removida"),r?.()}catch{h.error("Erro ao remover tag")}finally{t(!1)}},c=(d=>{const g=Number.parseInt(d.slice(1,3),16),k=Number.parseInt(d.slice(3,5),16),S=Number.parseInt(d.slice(5,7),16);return(g*299+k*587+S*114)/1e3>=128?"#000000":"#ffffff"})(s.color||"#000000");return e.jsxs(z,{className:T("gap-1 pr-1 transition-colors hover:bg-opacity-90"),style:{backgroundColor:s.color??void 0,color:c,borderColor:"transparent"},variant:"outline",children:[s.displayName||s.name,e.jsxs(u,{className:T("h-4 w-4 rounded-full bg-black/10 p-0 hover:bg-black/20",c==="#ffffff"?"text-white":"text-black"),disabled:n,onClick:a,size:"icon",variant:"ghost",children:[n?e.jsx(I,{className:"h-3 w-3 animate-spin"}):e.jsx(de,{className:"h-3 w-3"}),e.jsx("span",{className:"sr-only",children:"Remover tag"})]})]})}function Ts({leadId:s}){const{data:i,isLoading:r}=p.tags.getLeadTags.useQuery({leadId:s});return e.jsxs("section",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"flex items-center gap-2 font-medium text-muted-foreground text-sm uppercase tracking-wider",children:[e.jsx(ss,{className:"h-4 w-4"})," Etiquetas"]})}),e.jsx("div",{className:"rounded-lg border border-border/50 bg-card p-4",children:r?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(O,{className:"h-6 w-20 rounded-md"}),e.jsx(O,{className:"h-6 w-24 rounded-md"}),e.jsx(O,{className:"h-6 w-16 rounded-md"})]}):e.jsxs("div",{className:"space-y-3",children:[i&&i.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(l=>e.jsx(Ds,{leadId:s,tag:l},l.id))}):e.jsx("p",{className:"text-muted-foreground text-sm italic",children:"Nenhuma etiqueta adicionada."}),e.jsx("div",{className:"pt-2",children:e.jsx(Ss,{leadId:s})})]})})]})}const ks=fe({description:C().min(3,"DescriÃ§Ã£o deve ter pelo menos 3 caracteres"),dueDate:ps().optional(),mentionedUserIds:hs(C()).optional()});function As({leadId:s,onCancel:i,onSuccess:r}){const l=p.tasks.create.useMutation(),{data:n=[]}=p.users.list.useQuery(),[t,a]=x.useState(!1),[m,c]=x.useState(!1),d=je({resolver:ge(ks),defaultValues:{description:"",mentionedUserIds:[]}}),g=d.watch("mentionedUserIds")||[],k=async o=>{try{a(!0),await l.mutateAsync({leadId:s,description:o.description,dueDate:o.dueDate?o.dueDate.toISOString():void 0}),h.success("Tarefa criada com sucesso!"),d.reset(),r()}catch{h.error("Erro ao criar tarefa. Tente novamente.")}finally{a(!1)}},S=o=>{const y=d.getValues("mentionedUserIds")||[];y.includes(o)?d.setValue("mentionedUserIds",y.filter(E=>E!==o)):d.setValue("mentionedUserIds",[...y,o])};return e.jsx("div",{className:"slide-in-from-top-2 animate-in rounded-lg border bg-muted/30 p-4",children:e.jsx(ce,{...d,children:e.jsxs("form",{className:"space-y-4",onSubmit:d.handleSubmit(k),children:[e.jsx(f,{control:d.control,name:"description",render:({field:o})=>e.jsxs(b,{children:[e.jsx(N,{children:e.jsx(D,{className:"bg-background",placeholder:"O que precisa ser feito? (Ex: Ligar para apresentar proposta)",...o,autoFocus:!0})}),e.jsx(v,{})]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(f,{control:d.control,name:"dueDate",render:({field:o})=>e.jsxs(b,{className:"flex flex-col",children:[e.jsxs(q,{children:[e.jsx(B,{asChild:!0,children:e.jsx(N,{children:e.jsxs(u,{className:T("h-9 w-[180px] bg-background pl-3 text-left font-normal",!o.value&&"text-muted-foreground"),size:"sm",variant:"outline",children:[o.value?me(o.value,"d 'de' MMMM",{locale:F}):e.jsx("span",{children:"Data de vencimento"}),e.jsx(xe,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(Q,{align:"start",className:"w-auto p-0",children:e.jsx(Pe,{disabled:y=>y<new Date(new Date().setHours(0,0,0,0)),initialFocus:!0,mode:"single",onSelect:o.onChange,selected:o.value})})]}),e.jsx(v,{})]})}),e.jsxs(q,{onOpenChange:c,open:m,children:[e.jsx(B,{asChild:!0,children:e.jsxs(u,{className:"h-9 bg-background",size:"sm",variant:"outline",children:["@ Mencionar",g.length>0&&e.jsx("span",{className:"ml-1 rounded-full bg-primary/10 px-1.5 py-0.5 text-[10px] text-primary",children:g.length})]})}),e.jsx(Q,{align:"start",className:"p-0",children:e.jsxs(be,{children:[e.jsx(Ne,{placeholder:"Buscar usuÃ¡rio..."}),e.jsxs(ve,{children:[e.jsx(ye,{children:"Nenhum usuÃ¡rio encontrado."}),e.jsx(we,{children:n.map(o=>e.jsxs(Ce,{onSelect:()=>S(o.id),value:o.name,children:[e.jsx("div",{className:T("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",g.includes(o.id)?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx("svg",{"aria-hidden":"true",className:T("h-4 w-4"),fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:e.jsx("path",{d:"M5 13l4 4L19 7",strokeLinecap:"round",strokeLinejoin:"round"})})}),o.name]},o.id))})]})]})})]})]}),g.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:g.map(o=>{const y=n.find(E=>E.id===o);return y?e.jsxs("div",{className:"flex items-center gap-1 rounded-full bg-primary/10 px-3 py-1 text-primary text-xs",children:["@",y.name,e.jsx("button",{className:"ml-1 rounded-full hover:bg-primary/20",onClick:()=>S(o),type:"button",children:e.jsx(de,{className:"h-3 w-3"})})]},o):null})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(u,{disabled:t,onClick:i,size:"sm",type:"button",variant:"ghost",children:"Cancelar"}),e.jsx(u,{disabled:t,size:"sm",type:"submit",children:t?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"})," Salvando..."]}):"Criar Tarefa"})]})]})})})}function Is({tasks:s,isLoading:i}){const[r,l]=x.useState("all"),n=s?.filter(t=>r==="pending"?!t.completed:r==="completed"?t.completed:!0);return i?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(t=>e.jsx("div",{className:"h-20 animate-pulse rounded-lg bg-muted/20"},t))}):!s||s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-center text-muted-foreground",children:[e.jsx(ue,{className:"mb-2 h-10 w-10 opacity-20"}),e.jsx("p",{children:"Nenhuma tarefa encontrada."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(u,{className:"h-7 text-xs",onClick:()=>l("all"),size:"sm",variant:r==="all"?"secondary":"ghost",children:["Todas (",s.length,")"]}),e.jsxs(u,{className:"h-7 text-xs",onClick:()=>l("pending"),size:"sm",variant:r==="pending"?"secondary":"ghost",children:["Pendentes (",s.filter(t=>!t.completed).length,")"]}),e.jsxs(u,{className:"h-7 text-xs",onClick:()=>l("completed"),size:"sm",variant:r==="completed"?"secondary":"ghost",children:["ConcluÃ­das (",s.filter(t=>t.completed).length,")"]})]}),e.jsx("div",{className:"space-y-2",children:n?.length===0?e.jsx("div",{className:"py-8 text-center text-muted-foreground text-sm",children:"Nenhuma tarefa nesta categoria."}):n?.map(t=>e.jsx(Es,{task:t},t.id))})]})}function Es({task:s}){const i=p.leads.tasks.update.useMutation(),r=p.leads.tasks.delete.useMutation(),[l,n]=x.useState(!1),t=s.dueDate?new Date(s.dueDate):void 0,a=t&&as(t)&&!ae(t)&&!s.completed,m=t&&ae(t)&&!s.completed,c=async()=>{if(!s.completed)try{n(!0),await i({taskId:s.id}),h.success("Tarefa concluÃ­da!")}catch{h.error("Erro ao atualizar tarefa")}finally{n(!1)}},d=async()=>{try{n(!0),await r.mutateAsync({taskId:s.id}),h.success("Tarefa excluÃ­da")}catch{h.error("Erro ao excluir tarefa")}finally{n(!1)}};return e.jsxs("div",{className:T("group relative flex items-start gap-3 rounded-lg border bg-card p-3 transition-all hover:shadow-sm",a&&"border-l-4 border-l-red-500 bg-red-50/50",m&&"border-l-4 border-l-yellow-500 bg-yellow-50/50",!(a||m||s.completed)&&"border-l-4 border-l-green-500",s.completed&&"bg-muted/50 opacity-70"),children:[e.jsx("button",{className:T("mt-0.5 flex h-5 w-5 shrink-0 items-center justify-center rounded-full border transition-colors",s.completed?"border-primary bg-primary text-primary-foreground":"border-muted-foreground hover:border-primary"),disabled:l||s.completed,onClick:c,type:"button",children:s.completed?e.jsx(ue,{className:"h-3.5 w-3.5"}):e.jsx("div",{className:"h-3.5 w-3.5"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("p",{className:T("font-medium text-sm leading-none",s.completed&&"text-muted-foreground line-through"),children:s.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-muted-foreground text-xs",children:[t&&e.jsxs("span",{className:T("flex items-center gap-1",a&&"font-medium text-red-600",m&&"font-medium text-yellow-600"),children:[e.jsx(xe,{className:"h-3 w-3"}),me(t,"d 'de' MMM",{locale:F})]}),s.assignedToUser&&e.jsxs("span",{className:"flex items-center gap-1",title:`AtribuÃ­do a: ${s.assignedToUser.name}`,children:[e.jsx(rs,{className:"h-3 w-3"}),s.assignedToUser.name.split(" ")[0]]}),s.mentionedUsers&&s.mentionedUsers.length>0&&e.jsx("div",{className:"flex gap-1",children:s.mentionedUsers.map(g=>e.jsxs("span",{className:"rounded-full bg-muted px-1.5 py-0.5 text-[10px]",children:["@",g.name.split(" ")[0]]},g.id))})]})]}),e.jsx("div",{className:"opacity-0 transition-opacity group-hover:opacity-100",children:e.jsxs($,{children:[e.jsx(ze,{asChild:!0,children:e.jsx(u,{className:"h-6 w-6 text-muted-foreground hover:text-destructive",disabled:l,size:"icon",variant:"ghost",children:e.jsx(oe,{className:"h-3.5 w-3.5"})})}),e.jsxs(W,{children:[e.jsx(H,{children:e.jsx(G,{children:"Excluir tarefa?"})}),e.jsxs(J,{children:[e.jsx(K,{children:"Cancelar"}),e.jsx(X,{disabled:l,onClick:d,children:"Excluir"})]})]})]})})]})}function Ms({leadId:s}){const{data:i}=p.tasks.list.useQuery({leadId:s,limit:50}),[r,l]=x.useState(!1),n=i?.data,t=n?[...n].sort((a,m)=>{const c=!!a.completedAt,d=!!m.completedAt;return c!==d?c?1:-1:a.dueDate?m.dueDate?a.dueDate.getTime()-m.dueDate.getTime():-1:1}):[];return e.jsxs("div",{className:"space-y-4",children:[!r&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-sm",children:"Tarefas"}),e.jsxs(u,{className:"h-8 gap-1",onClick:()=>l(!0),size:"sm",children:[e.jsx(Z,{className:"h-3.5 w-3.5"})," Nova Tarefa"]})]}),r&&e.jsx(As,{leadId:s,onCancel:()=>l(!1),onSuccess:()=>l(!1)}),e.jsx(Is,{isLoading:n===void 0,tasks:t})]})}function Ls({leadId:s,leadName:i,leadPhone:r,open:l,onOpenChange:n}){const[t,a]=x.useState(""),[m,c]=x.useState(!1),d=x.useId(),g=p.whatsapp.sendMessage.useMutation(),k=async()=>{if(!t.trim()){h.error("A mensagem nÃ£o pode estar vazia.");return}try{c(!0),(await g.mutateAsync({phone:r,leadId:s,message:t})).success?(h.success("Mensagem enviada com sucesso!"),a(""),n(!1)):h.error("Erro ao enviar mensagem.")}catch{h.error("Ocorreu um erro ao enviar a mensagem.")}finally{c(!1)}};let S;return S=e.jsx("span",{className:"text-muted-foreground text-xs",children:"Nenhum modelo disponÃ­vel"}),e.jsx(te,{onOpenChange:n,open:l,children:e.jsxs(ne,{className:"sm:max-w-[500px]",children:[e.jsxs(ie,{children:[e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5 text-green-600"}),"Enviar Mensagem WhatsApp"]}),e.jsxs(Oe,{children:["Para: ",e.jsx("span",{className:"font-medium text-foreground",children:i})," (",r,")"]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium text-muted-foreground text-sm",children:"Modelos RÃ¡pidos"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:S})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"font-medium text-muted-foreground text-sm",htmlFor:d,children:"Mensagem"}),e.jsx(P,{className:"min-h-[150px] resize-none",id:d,onChange:o=>a(o.target.value),placeholder:"Digite sua mensagem aqui...",value:t}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("span",{className:`text-xs ${t.length>1e3?"text-red-500":"text-muted-foreground"}`,children:[t.length," caracteres"]})})]})]}),e.jsxs(Re,{children:[e.jsx(u,{disabled:m,onClick:()=>n(!1),variant:"ghost",children:"Cancelar"}),e.jsxs(u,{className:"gap-2",disabled:m||!t.trim(),onClick:k,children:[m?e.jsx(I,{className:"h-4 w-4 animate-spin"}):e.jsx(pe,{className:"h-4 w-4"}),"Enviar Mensagem"]})]})]})})}function Fs(s){return Array.isArray(s)?s.join(", "):typeof s=="boolean"?s?"Sim":"NÃ£o":String(s)}function Ws({leadId:s,onClose:i}){const{data:r}=p.leads.get.useQuery({id:s},{enabled:!!s}),{data:l}=p.activities.list.useQuery({leadId:s},{enabled:!!s}),{data:n}=p.tasks.list.useQuery({leadId:s,limit:50,offset:0},{enabled:!!s}),t=n?.data?.filter(d=>!d.completedAt).length??0,[a,m]=x.useState(!1),c=!!s;return e.jsxs(Ue,{onOpenChange:d=>!d&&i(),open:c,children:[e.jsxs(Ve,{className:"flex w-full flex-col overflow-hidden border-border/50 border-l bg-background/95 p-0 backdrop-blur-xl sm:max-w-2xl",side:"right",transition:{type:"spring",stiffness:150,damping:22},children:[e.jsxs(_e,{className:"sr-only",children:[e.jsx(qe,{children:"Detalhes do Lead"}),e.jsx(Be,{children:"Visualize as informaÃ§Ãµes, histÃ³rico e atividades deste lead no funil de vendas."})]}),r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-border/50 border-b bg-muted/20 p-6",children:[e.jsxs("div",{className:"mb-4 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold font-display text-2xl text-foreground tracking-tight",children:r.name??""}),e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-muted-foreground text-sm",children:[e.jsx(z,{className:"border-primary/50 bg-primary/10 text-primary",variant:"outline",children:(r.stage??"").replace("_"," ").toUpperCase()}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ts,{className:"h-3 w-3"}),"Atualizado"," ",Y(new Date(r.updatedAt??r.createdAt),{addSuffix:!0,locale:F})]})]})]}),e.jsx(bs,{lead:r,onClose:i})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{className:"flex-1 gap-2 border-0 bg-[#25D366] text-white hover:bg-[#128C7E]",onClick:()=>window.open(`https://wa.me/${(r.phone??"").replace(/\D/g,"")}`,"_blank"),size:"sm",children:[e.jsx(he,{className:"h-4 w-4"}),"WhatsApp"]}),e.jsxs(u,{className:"flex-1 gap-2",onClick:()=>m(!0),size:"sm",variant:"outline",children:[e.jsx(pe,{className:"h-4 w-4"}),"Msg"]}),e.jsxs(u,{className:"flex-1 gap-2",onClick:()=>{window.location.href=`tel:${r.phone??""}`},size:"sm",variant:"outline",children:[e.jsx(ns,{className:"h-4 w-4"}),"Ligar"]}),e.jsxs(u,{className:"flex-1 gap-2",disabled:!r.email,onClick:()=>{r.email&&(window.location.href=`mailto:${r.email}`)},size:"sm",title:r.email?void 0:"Sem email cadastrado",variant:"outline",children:[e.jsx(is,{className:"h-4 w-4"}),"Email"]})]})]}),e.jsxs(Qe,{className:"flex flex-1 flex-col overflow-hidden",defaultValue:"overview",children:[e.jsx("div",{className:"border-border/50 border-b bg-muted/10 px-6 pt-2",children:e.jsxs($e,{className:"gap-6 bg-transparent p-0",children:[e.jsx(M,{className:"rounded-none px-0 pb-2 data-[state=active]:border-primary data-[state=active]:border-b-2 data-[state=active]:bg-transparent data-[state=active]:shadow-none",value:"overview",children:"VisÃ£o Geral"}),e.jsx(M,{className:"rounded-none px-0 pb-2 data-[state=active]:border-primary data-[state=active]:border-b-2 data-[state=active]:bg-transparent data-[state=active]:shadow-none",value:"timeline",children:"Timeline"}),e.jsxs(M,{className:"rounded-none px-0 pb-2 data-[state=active]:border-primary data-[state=active]:border-b-2 data-[state=active]:bg-transparent data-[state=active]:shadow-none",value:"tasks",children:["Tarefas",t>0&&e.jsx(z,{className:"ml-2 h-5 min-w-5 px-1.5",variant:"destructive",children:t})]}),e.jsx(M,{className:"rounded-none px-0 pb-2 data-[state=active]:border-primary data-[state=active]:border-b-2 data-[state=active]:bg-transparent data-[state=active]:shadow-none",value:"notes",children:"Notas"}),e.jsx(M,{className:"rounded-none px-0 pb-2 data-[state=active]:border-primary data-[state=active]:border-b-2 data-[state=active]:bg-transparent data-[state=active]:shadow-none",value:"objections",children:"ObjeÃ§Ãµes"})]})}),e.jsxs(We,{className:"flex-1 p-6",children:[e.jsx(L,{className:"slide-in-from-left-2 mt-0 animate-in space-y-6 duration-300",value:"overview",children:e.jsx(Ps,{lead:r})}),e.jsx(L,{className:"slide-in-from-right-2 mt-0 animate-in space-y-4 duration-300",value:"timeline",children:e.jsx(zs,{activities:l})}),e.jsx(L,{className:"mt-0",value:"notes",children:e.jsx("div",{className:"flex h-40 items-center justify-center rounded-lg border-2 border-border/50 border-dashed bg-muted/10 text-muted-foreground",children:"Em breve: Notas e ComentÃ¡rios"})}),e.jsx(L,{className:"mt-0",value:"tasks",children:e.jsx(Ms,{leadId:r.id})}),e.jsx(L,{className:"mt-0",value:"objections",children:e.jsx(ws,{leadId:r.id})})]})]})]}):e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent"}),e.jsx("p",{className:"font-medium text-muted-foreground text-sm",children:"Carregando..."})]})})]}),r&&e.jsx(Ls,{leadId:r.id,leadName:r.name??"",leadPhone:r.phone??"",onOpenChange:m,open:a})]})}function Ps({lead:s}){const{data:i}=p.customFields.getValues.useQuery({entityId:s.id});return e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"mb-4",children:e.jsx(vs,{currentOwnerId:s.assignedTo,leadId:s.id})}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("h3",{className:"flex items-center gap-2 font-medium text-muted-foreground text-sm uppercase tracking-wider",children:[e.jsx(ls,{className:"h-4 w-4"})," Dados Profissionais"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"rounded-lg border border-border/50 bg-card p-3",children:[e.jsx("span",{className:"mb-1 block text-muted-foreground text-xs",children:"ProfissÃ£o"}),e.jsx("span",{className:"font-medium",children:s.profession??"NÃ£o informado"})]}),e.jsxs("div",{className:"rounded-lg border border-border/50 bg-card p-3",children:[e.jsx("span",{className:"mb-1 block text-muted-foreground text-xs",children:"ClÃ­nica"}),e.jsx("span",{className:"font-medium",children:s.hasClinic?s.clinicName??"Sim":"NÃ£o"}),s.clinicCity?e.jsx("span",{className:"block text-muted-foreground text-xs",children:s.clinicCity}):null]}),e.jsxs("div",{className:"rounded-lg border border-border/50 bg-card p-3",children:[e.jsx("span",{className:"mb-1 block text-muted-foreground text-xs",children:"ExperiÃªncia"}),e.jsx("span",{className:"font-medium",children:s.yearsInAesthetics!=null?`${s.yearsInAesthetics} anos`:"N/A"})]}),e.jsxs("div",{className:"rounded-lg border border-border/50 bg-card p-3",children:[e.jsx("span",{className:"mb-1 block text-muted-foreground text-xs",children:"Faturamento"}),e.jsx("span",{className:"font-medium",children:s.currentRevenue??"N/A"})]})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("h3",{className:"flex items-center gap-2 font-medium text-muted-foreground text-sm uppercase tracking-wider",children:[e.jsx(cs,{className:"h-4 w-4"})," Interesse"]}),e.jsxs("div",{className:"space-y-3 rounded-lg border border-border/50 bg-card p-4",children:[e.jsxs("div",{className:"flex justify-between border-border/30 border-b pb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Produto"}),e.jsx("span",{className:"font-medium text-primary",children:s.interestedProduct??"Indefinido"})]}),e.jsxs("div",{className:"flex justify-between border-border/30 border-b pb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Temperatura"}),e.jsxs(z,{variant:s.temperature==="quente"?"destructive":"secondary",children:[s.temperature==="quente"&&"ðŸ”¥ Quente",s.temperature==="morno"&&"ðŸŒ¤ï¸ Morno",s.temperature!=="quente"&&s.temperature!=="morno"&&"â„ï¸ Frio"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Dor Principal"}),e.jsx("p",{className:"text-sm",children:s.mainPain??"NÃ£o identificada"})]}),s.mainDesire?e.jsxs("div",{className:"space-y-1 border-border/30 border-t pt-2",children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Desejo / Objetivo"}),e.jsx("p",{className:"text-sm",children:s.mainDesire})]}):null]})]}),i&&i.length>0&&e.jsxs("section",{className:"space-y-3",children:[e.jsxs("h3",{className:"flex items-center gap-2 font-medium text-muted-foreground text-sm uppercase tracking-wider",children:[e.jsx(os,{className:"h-4 w-4"})," InformaÃ§Ãµes Adicionais"]}),e.jsx("div",{className:"grid grid-cols-2 gap-4 text-sm",children:i.map(r=>e.jsxs("div",{className:"rounded-lg border border-border/50 bg-card p-3",children:[e.jsx("span",{className:"mb-1 block text-muted-foreground text-xs",children:r.fieldDefinition?.name}),e.jsx("span",{className:"font-medium",children:Fs(r.value)})]},r.id))})]}),e.jsx(Cs,{leadId:s.id}),e.jsx(Ts,{leadId:s.id})]})}function zs({activities:s}){return s?s.length===0?e.jsx("div",{className:"py-10 text-center text-muted-foreground",children:"Nenhuma atividade registrada."}):e.jsx("div",{className:"relative ml-3 space-y-6 border-border/50 border-l",children:s.map(i=>e.jsxs("div",{className:"relative pl-6",children:[e.jsx("div",{className:"absolute top-1 -left-[5px] h-2.5 w-2.5 rounded-full border-2 border-background bg-primary ring-2 ring-primary/20"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:Y(new Date(i.createdAt),{addSuffix:!0,locale:F})}),e.jsx("p",{className:"font-medium text-sm",children:i.description}),e.jsx("span",{className:"w-fit rounded-full bg-muted px-2 py-0.5 text-muted-foreground text-xs capitalize",children:(i.type??"").replace("_"," ")})]})]},i.id))}):e.jsx("div",{className:"space-y-4",children:[1,2,3].map(i=>e.jsx("div",{className:"h-16 animate-pulse rounded-lg bg-muted/20"},i))})}export{Ws as LeadDetail};
