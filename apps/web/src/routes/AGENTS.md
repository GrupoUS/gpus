# src/routes/ - Pages & Routing

## Package Identity

**Purpose:** File-based routing with TanStack Router  
**Tech:** TanStack Router + React 19

---

## Setup & Run

Routes are auto-discovered by TanStack Router plugin.

```bash
# Development (from root)
bun run dev

# Route types are auto-generated in src/routeTree.gen.ts
```

---

## Patterns & Conventions

### File-Based Routing

```
routes/
├── __root.tsx              # Root layout (providers, global styles)
├── index.tsx               # Landing page (/)
├── sign-in/                # Clerk sign-in
│   ├── index.tsx           # /sign-in
│   ├── $.tsx               # Catch-all for Clerk flows
│   └── sso-callback.tsx    # SSO callback
├── sign-up/                # Clerk sign-up
│   ├── index.tsx           # /sign-up
│   ├── $.tsx               # Catch-all for Clerk flows
│   └── sso-callback.tsx    # SSO callback
└── _authenticated/         # ⚠️ PROTECTED LAYOUT (requires auth)
    ├── _authenticated.tsx  # Layout with sidebar
    ├── dashboard.tsx       # /dashboard
    ├── crm.tsx             # /crm (pipeline)
    ├── students.tsx        # /students (list)
    ├── students/
    │   └── $studentId.tsx  # /students/:studentId (detail)
    ├── chat.tsx            # /chat layout
    ├── chat/
    │   ├── index.tsx       # /chat
    │   ├── $department.tsx # /chat/:department layout
    │   └── $department/
    │       ├── index.tsx   # /chat/:department
    │       └── $id.tsx     # /chat/:department/:id
    ├── reports.tsx         # /reports layout
    ├── reports/
    │   ├── sales.tsx       # /reports/sales
    │   └── team.tsx        # /reports/team
    ├── settings.tsx        # /settings layout
    └── settings/
        ├── integrations.tsx # /settings/integrations
        ├── team.tsx        # /settings/team
        └── templates.tsx   # /settings/templates
```

### Route Definition

✅ **DO:** Use `createFileRoute` for pages
```tsx
// src/routes/index.tsx
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/')({
  component: DashboardPage,
})

function DashboardPage() {
  return <div>Dashboard</div>
}
```

✅ **DO:** Use `createRootRoute` for root layout
```tsx
// src/routes/__root.tsx
import { createRootRoute, Outlet } from '@tanstack/react-router'
import { MainLayout } from '@/components/layout/main-layout'

export const Route = createRootRoute({
  component: () => (
    <MainLayout>
      <Outlet />
    </MainLayout>
  ),
})
```

### Dynamic Routes

✅ **DO:** Use `$` prefix for dynamic params
```tsx
// src/routes/crm/$leadId.tsx
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/crm/$leadId')({
  component: LeadDetailPage,
})

function LeadDetailPage() {
  const { leadId } = Route.useParams()
  return <div>Lead: {leadId}</div>
}
```

### Navigation

✅ **DO:** Use `Link` component for navigation
```tsx
import { Link } from '@tanstack/react-router'

<Link to="/crm">Go to CRM</Link>
<Link to="/crm/$leadId" params={{ leadId: '123' }}>View Lead</Link>
```

✅ **DO:** Use `useNavigate` for programmatic navigation
```tsx
import { useNavigate } from '@tanstack/react-router'

const navigate = useNavigate()
navigate({ to: '/crm' })
```

### Protected Routes (`_authenticated/`)

The project uses a **pathless layout route** (`_authenticated`) to protect routes:

✅ **DO:** Place protected routes inside `_authenticated/` folder
```
routes/_authenticated/dashboard.tsx  → /dashboard (protected)
routes/_authenticated/crm.tsx        → /crm (protected)
```

✅ **DO:** Use `beforeLoad` for route-level auth checks
```tsx
// src/routes/_authenticated.tsx
export const Route = createFileRoute('/_authenticated')({
  beforeLoad: async ({ context }) => {
    // Auth check happens here - redirects if not authenticated
  },
  component: AuthenticatedLayout,
})

function AuthenticatedLayout() {
  return (
    <MainLayout>
      <Outlet />
    </MainLayout>
  )
}
```

✅ **DO:** Use Clerk's `<SignedIn>` for component-level checks
```tsx
import { SignedIn, SignedOut, RedirectToSignIn } from '@clerk/clerk-react'

// In component
<SignedIn>
  <ProtectedContent />
</SignedIn>
<SignedOut>
  <RedirectToSignIn />
</SignedOut>
```

❌ **DON'T:** Create protected routes outside `_authenticated/`
```tsx
// AVOID - routes at root level are public
routes/dashboard.tsx  // This would be public!
```

---

## Touch Points / Key Files

| File | Purpose |
|------|---------|
| `src/routes/__root.tsx` | Root layout with sidebar |
| `src/routes/index.tsx` | Dashboard page |
| `src/routes/sign-in.tsx` | Sign in page (Clerk) |
| `src/routes/crm/index.tsx` | CRM page |
| `src/routeTree.gen.ts` | Auto-generated route types |

---

## JIT Index Hints

```bash
# Find all routes
rg -n "createFileRoute" src/routes

# Find route params usage
rg -n "useParams" src/routes

# Find navigation
rg -n "useNavigate|Link to=" src/routes
```

---

## Common Gotchas

- **Route types:** Auto-generated by TanStack Router plugin (don't edit `routeTree.gen.ts`)
- **File naming:** Use `__root.tsx` for root layout, `index.tsx` for index routes
- **Dynamic params:** Use `$paramName.tsx` for dynamic segments
- **Nested routes:** Create subdirectories for nested routes
- **Clerk:** Wrap protected routes with `<SignedIn>` component

---

## Pre-PR Checks

```bash
# Ensure routes compile
bun run build
```
