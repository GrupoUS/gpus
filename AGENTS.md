# Portal Grupo US - AI Agent Guide

## Project Snapshot

**Type:** Single-project React application  
**Stack:** React 19 + Vite + TanStack Router + shadcn/ui + Convex + Clerk  
**Purpose:** CRM and student management portal for health aesthetics education business  
**Note:** Sub-directories have their own AGENTS.md files with detailed patterns

---

## Package Manager

**⚠️ IMPORTANTE**: Este projeto **sempre usa `bun`** como package manager. Nunca use `npm`, `yarn` ou `pnpm`.

- ✅ **Sempre use**: `bun install`, `bun run`, `bunx`
- ❌ **Nunca use**: `npm install`, `npm run`, `npx`

## Root Setup Commands

```bash
# Install dependencies (sempre use bun)
bun install

# Development (runs Convex + Vite concurrently)
bun run dev

# Type checking
bun run build  # Includes tsc --noEmit

# Linting & formatting
bun run lint        # Auto-fix with Biome
bun run lint:check  # Check only

# Testing
bun run test              # Run all tests
bun run test:watch        # Watch mode
bun run test:coverage     # With coverage
```

### Advanced Dev Commands

```bash
# Web development only
bun run dev:web          # Vite dev server (without Convex)

# TypeScript watch mode
bun run dev:ts           # Type checking in watch mode

# Convex development only
bun run dev:convex       # Convex dev server (without Vite)

# Code formatting
bun run format           # Format code with Biome
bun run format:check      # Check code formatting only
```

---

## Universal Conventions

**Code Style:**
- TypeScript strict mode enabled
- Biome for linting/formatting (tabs, single quotes, semicolons)
- No `any` types (enforced by Biome)
- Functional components only (no classes)

**Commit Format:**
- Use Conventional Commits (e.g., `feat:`, `fix:`, `docs:`)

**Branch Strategy:**
- `main` branch for production
- Feature branches: `feature/description`

**PR Requirements:**
- All tests passing (`bun run test`)
- No linting errors (`bun run lint:check`)
- Type checking passes (`bun run build`)

---

## Security & Secrets

- **Never commit:** API keys, tokens, or credentials
- **Environment variables:** Use `.env.local` (gitignored)
- **Required vars:** `VITE_CLERK_PUBLISHABLE_KEY`, `VITE_CONVEX_URL`
- **PII handling:** User data stored in Convex with Clerk auth

---

## JIT Index - Directory Map

### Package Structure
- **Frontend app:** `src/` → [see src/AGENTS.md](src/AGENTS.md)
- **Backend (Convex):** `convex/` → [see convex/AGENTS.md](convex/AGENTS.md)
- **UI Components:** `src/components/` → [see src/components/AGENTS.md](src/components/AGENTS.md)
- **Routes/Pages:** `src/routes/` → [see src/routes/AGENTS.md](src/routes/AGENTS.md)
- **Hooks:** `src/hooks/` → [see src/hooks/AGENTS.md](src/hooks/AGENTS.md)
- **Utilities:** `src/lib/` → [see src/lib/AGENTS.md](src/lib/AGENTS.md)
- **Documentation:** `docs/` → PRD, tech stack, setup guides

### Quick Find Commands

```bash
# Find a component
rg -n "export.*function.*ComponentName" src/components

# Find a route
rg -n "createFileRoute" src/routes

# Find a Convex function
rg -n "export const" convex/

# Find a hook
rg -n "export.*use[A-Z]" src/hooks

# Find type definitions
rg -n "interface|type.*=" src/
```

---

## Definition of Done

Before creating a PR:
- [ ] All tests pass (`bun run test`)
- [ ] No linting errors (`bun run lint:check`)
- [ ] Type checking passes (`bun run build`)
- [ ] Code formatted (`bun run lint`)
- [ ] No console errors in browser
- [ ] Responsive design tested (mobile + desktop)

---

## Quick Reference

| Task | Command |
|------|---------|
| Add shadcn component | `bunx shadcn@latest add [component]` |
| Deploy Convex | `bunx convex deploy` |
| Generate route types | Auto-generated by TanStack Router plugin |
| View Convex dashboard | `bunx convex dashboard` |

**For detailed patterns, see sub-directory AGENTS.md files.**

---

## OpenCode Agents & Commands

### Available Agents

| Agent | Mode | Description |
|-------|------|-------------|
| `apex-dev` | Primary | Full-stack developer with TDD methodology. Orchestrates subagents. |
| `apex-researcher` | Primary | Research & planning specialist. NEVER implements. |
| `code-reviewer` | Subagent | Security architect with OWASP + LGPD compliance. Read-only. |
| `database-specialist` | Subagent | Convex expert for schema, queries, mutations. |
| `apex-ui-ux-designer` | Subagent | UI/UX with accessibility-first approach + shadcn/ui. |

### Available Commands

| Command | Description |
|---------|-------------|
| `/research [topic]` | Multi-source research with cross-validation |
| `/qc [scope]` | Quality control pipeline (lint, build, test, deploy) |
| `/clean [scope]` | Dead code detection and cleanup with Knip |

### MCP Tools Available

| MCP | Purpose |
|-----|---------|
| `serena` | Semantic code analysis, symbol discovery |
| `gh_grep` | Search real-world GitHub code patterns |
| `context7` | Official documentation lookup |
| `tavily` | Web search for current patterns (research only) |
| `sequential_thinking` | Step-by-step reasoning (research only) |
| `docker` | Container management |

### Agent Invocation

```bash
# Invoke primary agents
@apex-dev      # For implementation tasks
@apex-researcher  # For research/planning tasks

# Invoke subagents (from apex-dev)
@code-reviewer        # Security/compliance review
@database-specialist  # Convex database tasks
@apex-ui-ux-designer  # UI/UX components
```
